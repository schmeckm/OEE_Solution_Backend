
Flow: handleOeeMessage

+-----------------------------------------+
|  Start: handleOeeMessage(decodedMessage, machineId)  |
+-----------------------------------------+
            |
            v
+-----------------------------------------+
|  Initialize oeeData for machineId if needed  |
+-----------------------------------------+
            |
            v
+-----------------------------------------+
|  Load processOrderData                  |
+-----------------------------------------+
            |
            v
+-----------------------------------------+
|  For each metric in decodedMessage      |
|  +------------------------------------+ |
|  |  Is metric defined in oeeConfig?   | |
|  +------------------------------------+ |
|             |                           |
|      Yes    |                  No       |
|             v                           v
|  +-------------------------------+      |
|  |  Is metric from MQTT data?     |<--+  |
|  +-------------------------------+   |  |
|             |                           |
|      Yes    |                   No      |
|             v                           |
|  +----------------------------------+   |
|  |  Update metric from MQTT data    |   |
|  +----------------------------------+   |
|                                         |
|  +----------------------------------+   |
|  |  Update metric from process order|   |
|  +----------------------------------+   |
|                                         |
|  +----------------------------------+   |
|  |  Skip invalid/undefined metric   |<--+
|  +----------------------------------+   
+-----------------------------------------+
            |
            v
+-----------------------------------------+
|  Process valid metrics (processMetrics) |
+-----------------------------------------+
            |
            v
+-----------------------------------------+
|  Log final OEE data                     |
+-----------------------------------------+
            |
            v
+-----------------------------------------+
|  End: handleOeeMessage                  |
+-----------------------------------------+


Flow: handleCommandMessage

+-----------------------------------------+
|  Start: handleCommandMessage(decodedMessage, machineId) |
+-----------------------------------------+
            |
            v
+-----------------------------------------+
|  For each command in decodedMessage     |
|  +------------------------------------+ |
|  |  Is command valid?                 | |
|  +------------------------------------+ |
|             |                           |
|      Yes    |                  No       |
|             v                           v
|  +----------------------------------+   |
|  |  Handle command (Hold, Unhold,   |   |
|  |  Start, End)                     |   |
|  +----------------------------------+   |
|                                         |
|  +----------------------------------+   |
|  |  Skip unknown command            |<--+
|  +----------------------------------+   
+-----------------------------------------+
            |
            v
+-----------------------------------------+
|  End: handleCommandMessage              |
+-----------------------------------------+